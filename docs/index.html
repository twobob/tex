<!DOCTYPE html>
<html>
  <head>
    <title>texturedgrooves Soundcloud Backup</title>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,400i" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/amplitudejs@5.3.2/dist/amplitude.js"></script>
    <script type="text/javascript" src="https://amplitude-cdn.serversideup.net/visualizations/michaelbromley.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>

    <style>
      html, body {
        background-color: #333;
        font-family: "Lato", sans-serif;
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      /* Responsive wrapper */
      #player-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: #333;
      }

      /* Base player container */
      #visualizations-player {
        width: 90vw;
        max-width: 500px;
        background-color: #212323;
        border-radius: 20px;
        padding: 20px;
        overflow: visible;
        position: relative;
        transition: width 0.25s ease, height 0.25s ease;
        box-sizing: border-box;
      }

      @media (max-width: 600px) {
        #visualizations-player {
          width: 95vw;
          padding: 15px;
        }
      }

      /* === Base component styling === */
      div#pre-load-img-container {
        display: none;
      }

      div.top-container {
        margin-bottom: 30px;
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      div.top-container div.amplitude-visualization {
        width: 180px;
        height: 180px;
        max-width: 90%;
        max-height: 180px;
        box-shadow: 0 5px 31px 0 rgba(0, 0, 0, 0.5);
        margin: auto;
        background-color: black;
      }

      div.top-container img.now-playing-album-art {
        width: 180px;
        max-width: 90%;
        margin: auto;
        box-shadow: 0 5px 31px 0 rgba(0, 0, 0, 0.5);
        display: none;
      }

      div.top-container div.visualization-toggle {
        width: 50px;
        height: 50px;
        top: 5px;
        right: 5px;
        cursor: pointer;
        position: absolute;
        background-color: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      div.top-container div.visualization-toggle:active {
        transform: scale(0.9);
        background-color: rgba(255, 255, 255, 0.25);
      }

      div.top-container div.visualization-toggle.visualization-on::before {
        content: '';
        width: 50%;
        height: 50%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/visualization-on.svg") no-repeat center;
        background-size: contain;
      }

      div.top-container div.visualization-toggle.visualization-off::before {
        content: '';
        width: 50%;
        height: 50%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/visualization-off.svg") no-repeat center;
        background-size: contain;
      }

      div.top-container div.amplitude-shuffle {
        width: 50px;
        height: 50px;
        cursor: pointer;
        top: 62px;
        right: 5px;
        position: absolute;
        background-color: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      div.top-container div.amplitude-shuffle:active {
        transform: scale(0.9);
        background-color: rgba(255, 255, 255, 0.25);
      }

      div.top-container div.amplitude-shuffle.amplitude-shuffle-on {
        background-color: rgba(76, 242, 152, 0.3);
      }

      div.top-container div.amplitude-shuffle.amplitude-shuffle-on::before,
      div.top-container div.amplitude-shuffle.amplitude-shuffle-off::before {
        content: '';
        width: 50%;
        height: 50%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/shuffle-on.svg") no-repeat center;
        background-size: contain;
      }

      div.top-container div.amplitude-repeat {
        width: 50px;
        height: 50px;
        cursor: pointer;
        top: 119px;
        right: 5px;
        position: absolute;
        background-color: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      div.top-container div.amplitude-repeat:active {
        transform: scale(0.9);
        background-color: rgba(255, 255, 255, 0.25);
      }

      div.top-container div.amplitude-repeat.amplitude-repeat-on {
        background-color: rgba(76, 242, 152, 0.3);
      }

      div.top-container div.amplitude-repeat.amplitude-repeat-on::before,
      div.top-container div.amplitude-repeat.amplitude-repeat-off::before {
        content: '';
        width: 50%;
        height: 50%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/repeat-on.svg") no-repeat center;
        background-size: contain;
      }

      div.control-container {
        margin-top: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 3%;
        width: 100%;
        padding: 0 5%;
        box-sizing: border-box;
      }

      div.control-container div.amplitude-prev {
        width: 22%;
        height: 70px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        cursor: pointer;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        position: relative;
      }

      div.control-container div.amplitude-prev:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.25);
      }

      div.control-container div.amplitude-prev::before {
        content: '';
        width: 35%;
        height: 35%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/prev.svg") no-repeat center;
        background-size: contain;
      }

      div.control-container div.amplitude-play-pause {
        width: 28%;
        height: 80px;
        cursor: pointer;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      div.control-container div.amplitude-play-pause:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.3);
      }

      div.control-container div.amplitude-play-pause.amplitude-playing::before {
        content: '';
        width: 40%;
        height: 40%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/pause.svg") no-repeat center;
        background-size: contain;
      }

      div.control-container div.amplitude-play-pause.amplitude-paused::before {
        content: '';
        width: 40%;
        height: 40%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/play.svg") no-repeat center;
        background-size: contain;
      }

      div.control-container div.amplitude-next {
        width: 22%;
        height: 70px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        cursor: pointer;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        position: relative;
      }

      div.control-container div.amplitude-next:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.25);
      }

      div.control-container div.amplitude-next::before {
        content: '';
        width: 35%;
        height: 35%;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/next.svg") no-repeat center;
        background-size: contain;
      }

      div.meta-data-container {
        margin-top: 30px;
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
      }

      div.meta-data-container span.now-playing-name {
        display: block;
        text-align: center;
        margin-bottom: 10px;
        font-size: 22px;
        font-weight: 700;
        color: white;
        word-wrap: break-word;
        overflow-wrap: break-word;
        white-space: normal;
        line-height: 1.3;
        padding: 0 5px;
      }

      div.meta-data-container span.now-playing-artist-album {
        display: block;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
        padding: 0 5px;
      }

      div.amplitude-wave-form {
        margin-top: 20px;
        margin-bottom: 10px;
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
      }

      div.amplitude-wave-form svg {
        stroke: url(#gradient);
        height: 50px;
        width: 100%;
        stroke-width: 0.5px;
      }

      span.amplitude-current-time {
        display: block;
        text-align: left;
        color: white;
        font-size: 11px;
        padding: 0 10px;
      }

      span.amplitude-time-remaining {
        display: block;
        text-align: right;
        color: white;
        font-size: 11px;
        padding: 0 10px;
      }

      div.song-navigation {
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
        margin-top: 15px;
      }

      div.song-navigation input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        background-color: inherit;
      }

      div.arrow-up {
        width: 100%;
        text-align: center;
        margin-top: 20px;
        margin-bottom: 15px;
      }

      div.arrow-up img.arrow-up-icon {
        cursor: pointer;
        display: inline-block;
        width: 60px;
        height: 40px;
        padding: 15px 30px;
        background-color: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 40px;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      div.arrow-up img.arrow-up-icon:active {
        transform: scale(0.95);
        background-color: rgba(255, 255, 255, 0.25);
      }

      /* Volume control styles */
      div.volume-container {
        margin-top: 15px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        padding: 15px 20px;
        width: 100%;
        box-sizing: border-box;
        background-color: rgba(255, 255, 255, 0.08);
        border-radius: 50px;
        margin-left: auto;
        margin-right: auto;
        max-width: 90%;
      }

      div.volume-icon {
        width: 24px;
        height: 24px;
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/volume.svg") no-repeat center;
        background-size: contain;
        opacity: 0.9;
        flex-shrink: 0;
      }

      input[type="range"].amplitude-volume-slider {
        flex: 1;
        max-width: 65%;
        -webkit-appearance: none;
        background-color: inherit;
        height: 8px;
      }

      input[type="range"].amplitude-volume-slider:focus {
        outline: none;
      }

      input[type="range"].amplitude-volume-slider::-webkit-slider-runnable-track {
        width: 100%;
        height: 8px;
        cursor: pointer;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.2);
      }

      input[type="range"].amplitude-volume-slider::-webkit-slider-thumb {
        width: 24px;
        height: 24px;
        background-color: white;
        border-radius: 50%;
        -webkit-appearance: none;
        margin-top: -8px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s ease;
      }

      input[type="range"].amplitude-volume-slider::-webkit-slider-thumb:active {
        transform: scale(1.1);
      }

      input[type="range"].amplitude-volume-slider::-moz-range-track {
        width: 100%;
        height: 8px;
        cursor: pointer;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.2);
      }

      input[type="range"].amplitude-volume-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background-color: white;
        border-radius: 50%;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .volume-percentage {
        color: white;
        font-size: 14px;
        font-weight: 600;
        min-width: 42px;
        text-align: right;
        flex-shrink: 0;
      }

      input[type="range"]#global-large-song-slider {
        width: 100%;
        margin-top: -74px;
        -webkit-appearance: none;
        z-index: 9999;
        background-color: inherit;
        margin-left: auto;
        margin-right: auto;
        display: block;
      }

      input[type="range"]#global-large-song-slider::-webkit-slider-thumb {
        width: 5px;
        height: 68px;
        background-color: white;
        border-radius: 20px;
        -webkit-appearance: none;
      }

      /* Playlist overlay styles */
      div#visualizations-player-playlist {
        background-color: #482D57;
        border-radius: 20px;
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        padding: 25px;
        padding-top: 25px;
        z-index: 9999;
        display: none;
      }

      div#visualizations-player-playlist div.top-arrow {
        text-align: center;
      }

      div#visualizations-player-playlist div.top-arrow img {
        cursor: pointer;
      }

      div#visualizations-player-playlist div.top {
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      div#visualizations-player-playlist div.top span.playlist-title {
        color: white;
        font-size: 36px;
        font-weight: 700;
      }

      div#visualizations-player-playlist div.top div.amplitude-shuffle {
        width: 22px;
        height: 13px;
        cursor: pointer;
        float: right;
        margin-top: 22px;
      }

      div#visualizations-player-playlist div.top div.amplitude-shuffle.amplitude-shuffle-on {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/shuffle-on.svg") no-repeat center;
      }

      div#visualizations-player-playlist div.top div.amplitude-shuffle.amplitude-shuffle-off {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/shuffle-off.svg") no-repeat center;
      }

      div#visualizations-player-playlist div.top div.amplitude-repeat {
        width: 25px;
        height: 15px;
        cursor: pointer;
        float: right;
        margin-left: 25px;
        margin-top: 20px;
      }

      div#visualizations-player-playlist div.top div.amplitude-repeat.amplitude-repeat-on {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/repeat-on.svg") no-repeat center;
      }

      div#visualizations-player-playlist div.top div.amplitude-repeat.amplitude-repeat-off {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/repeat-off.svg") no-repeat center;
      }

      div#visualizations-player-playlist div.songs-container {
        padding-top: 35px;
        height: 400px;
        padding-bottom: 90px;
        overflow-y: scroll;
      }

      div#visualizations-player-playlist div.songs-container div.song {
        margin-bottom: 20px;
        cursor: pointer;
        padding: 5px;
        border-radius: 3px;
      }

      div#visualizations-player-playlist div.songs-container div.song.amplitude-active-song-container {
        background-color: #03C1EB;
      }

      div#visualizations-player-playlist div.songs-container div.song:hover {
        background-color: #4CF298;
      }

      div#visualizations-player-playlist div.songs-container div.song span.song-position {
        color: white;
        font-size: 18px;
        float: left;
      }

      div#visualizations-player-playlist div.songs-container div.song img.song-album-art {
        width: 44px;
        height: 44px;
        border-radius: 4px;
        box-shadow: 0 2px 7px 0 rgba(0, 0, 0, 0.5);
        float: left;
        margin-left: 12px;
        margin-right: 16px;
      }

      div#visualizations-player-playlist div.songs-container div.song div.song-meta-data-container {
        float: left;
        width: calc(100% - 105px);
      }

      div#visualizations-player-playlist div.songs-container div.song div.song-meta-data-container span.song-name {
        font-size: 18px;
        display: block;
        color: white;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      div#visualizations-player-playlist div.songs-container div.song div.song-meta-data-container span.song-artist {
        font-size: 12px;
        display: block;
        color: white;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      div#visualizations-player-playlist div.songs-container div.song:after {
        content: "";
        display: table;
        clear: both;
      }

      div#visualizations-player-playlist div.active-audio {
        background-color: rgba(3, 193, 235, 0.7);
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 40px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left: 25px;
        padding-right: 25px;
        display: flex;
      }

      div#visualizations-player-playlist div.active-audio img.cover-art-small {
        width: 50px;
        height: 50px;
        border-radius: 4px;
        float: left;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right {
        float: left;
        width: calc(100% - 50px);
        padding-left: 10px;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right span.song-name {
        font-size: 16px;
        color: white;
        display: block;
        text-align: center;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls {
        text-align: center;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls div.amplitude-prev {
        width: 18px;
        height: 26px;
        display: inline-block;
        background-size: contain;
        background: url(https://amplitude-cdn.serversideup.net/img/examples/visualizations/prev.svg) no-repeat center;
        margin-right: 20px;
        vertical-align: middle;
        cursor: pointer;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls div.amplitude-play-pause {
        display: inline-block;
        width: 24px;
        height: 25px;
        cursor: pointer;
        margin: auto;
        vertical-align: middle;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls div.amplitude-play-pause.amplitude-paused {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/small-play.svg") no-repeat center;
        background-size: contain;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls div.amplitude-play-pause.amplitude-playing {
        background: url("https://amplitude-cdn.serversideup.net/img/examples/visualizations/small-pause.svg") no-repeat center;
        background-size: contain;
      }

      div#visualizations-player-playlist div.active-audio div.active-audio-right div.active-audio-controls div.amplitude-next {
        width: 18px;
        height: 26px;
        display: inline-block;
        background-size: contain;
        background: url(https://amplitude-cdn.serversideup.net/img/examples/visualizations/next.svg) no-repeat center;
        margin-left: 20px;
        vertical-align: middle;
        cursor: pointer;
      }

      a.learn-more {
        display: block;
        color: white;
        text-align: center;
        width: 300px;
        border-radius: 5px;
        text-decoration: none;
        padding: 10px;
        margin: auto;
        margin-top: 20px;
        background-color: #482D57;
      }
    </style>
  </head>

  <body>
    <div id="player-wrapper">
      <div id="visualizations-player">
        <div class="top-container">
          <img class="now-playing-album-art" id="large-now-playing-album-art" data-amplitude-song-info="cover_art_url"/>
          <div class="amplitude-visualization" id="large-visualization"></div>
          <div class="visualization-toggle visualization-on"></div>
          <div class="amplitude-shuffle"></div>
          <div class="amplitude-repeat"></div>
        </div>

        <div class="meta-data-container">
          <span class="now-playing-name" data-amplitude-song-info="name"></span>
          <span class="now-playing-artist-album">
            <span class="now-playing-artist" data-amplitude-song-info="artist"></span> -
            <span class="now-playing-album" data-amplitude-song-info="album"></span>
          </span>
        </div>

        <div class="amplitude-wave-form"></div>
        <input type="range" class="amplitude-song-slider" id="global-large-song-slider"/>

        <div>
          <span class="amplitude-current-time"></span>
          <span class="amplitude-time-remaining"></span>
        </div>

        <div class="control-container">
          <div class="amplitude-prev"></div>
          <div class="amplitude-play-pause amplitude-paused"></div>
          <div class="amplitude-next"></div>
        </div>

        <div class="arrow-up">
          <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/arrow-up.svg" class="arrow-up-icon"/>
        </div>

        <div class="volume-container">
          <div class="volume-icon"></div>
          <input type="range" class="amplitude-volume-slider" step="1"/>
          <span class="volume-percentage">100%</span>
        </div>

        <div id="visualizations-player-playlist">
          <div class="top-arrow">
            <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/arrow-down.svg" class="arrow-down-icon"/>
          </div>

          <div class="top">
            <span class="playlist-title">Songs</span>
            <div class="amplitude-repeat"></div>
            <div class="amplitude-shuffle"></div>
          </div>

          <div class="songs-container" id="dynamic-songs-list">
            <!-- Songs will be dynamically generated here -->
          </div>

          <div class="active-audio">
            <img class="cover-art-small" data-amplitude-song-info="cover_art_url"/>
            <div class="active-audio-right">
              <span class="song-name" data-amplitude-song-info="name"></span>
              <div class="active-audio-controls">
                <div class="amplitude-prev"></div>
                <div class="amplitude-play-pause"></div>
                <div class="amplitude-next"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="pre-load-img-container" style="display:none">
      <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/play.svg"/>
      <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/pause.svg"/>
      <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/next.svg"/>
      <img src="https://amplitude-cdn.serversideup.net/img/examples/visualizations/prev.svg"/>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#03C1EB" />
          <stop offset="100%" stop-color="#86F3B8" />
        </linearGradient>
      </defs>
    </svg>

    <script type="text/javascript">
      // Utility: fetch JSON from a URL
      function fetchJson(url) {
        return fetch(url).then(response => {
          if (!response.ok) throw new Error("GitHub API fetch failed");
          return response.json();
        });
      }

      (function(){
        const owner = "twobob";
        const repo = "tex";
        const branch = "main";
        const folder = "/music";
        const rawBase = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/`;
        const coverArt = "https://github.com/twobob/Hobo/blob/main/docs/art/default.png?raw=true";
        const treeUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

        // Function to extract album art from already-loaded MP3 data
        async function extractAlbumArtFromAudio() {
          try {
            const audioElement = Amplitude.getAudio();
            if (!audioElement || !audioElement.src) {
              return coverArt;
            }

            // Fetch the MP3 as a blob - this should use the browser cache
            const response = await fetch(audioElement.src);
            const blob = await response.blob();
            
            return new Promise((resolve) => {
              // Read tags from the blob
              window.jsmediatags.read(blob, {
                onSuccess: function(tag) {
                  const tags = tag.tags;
                  let artworkUrl = coverArt;
                  
                  if (tags.picture) {
                    const picture = tags.picture;
                    const base64String = picture.data.reduce((acc, byte) => acc + String.fromCharCode(byte), '');
                    artworkUrl = `data:${picture.format};base64,${btoa(base64String)}`;
                  }
                  
                  resolve(artworkUrl);
                },
                onError: function(error) {
                  console.log('Could not extract album art:', error);
                  resolve(coverArt);
                }
              });
            });
          } catch (error) {
            console.log('Error fetching audio data:', error);
            return coverArt;
          }
        }

        fetchJson(treeUrl).then(async data => {
          if (!data.tree) {
            console.error("Unexpected response structure:", data);
            return;
          }

          const songs = [];

          for (const entry of data.tree) {
            if (entry.type === "blob" && entry.path.startsWith(folder) && entry.path.toLowerCase().endsWith(".mp3")) {
              const filePath = entry.path;
              const url = rawBase + encodeURIComponent(filePath).replace(/%2F/g, "/");
              let name = filePath.substring(folder.length).replace(/[-_]+/g, " ").replace(/\.mp3$/i, "").trim();

              songs.push({
                "name": name,
                "artist": "texturedgrooves",
                "album": "github player",
                "url": url,
                "cover_art_url": coverArt // Start with default
              });
            }
          }

          if (songs.length === 0) {
            console.warn("No MP3 files found in", folder);
            return;
          }

          console.log(`Loaded ${songs.length} tracks from GitHub:`, songs.map(s => s.name));

          // Generate playlist HTML dynamically
          const songsContainer = document.getElementById('dynamic-songs-list');
          songs.forEach((song, index) => {
            const songDiv = document.createElement('div');
            songDiv.className = 'song amplitude-song-container amplitude-play-pause';
            songDiv.setAttribute('data-amplitude-song-index', index);
            
            songDiv.innerHTML = `
              <span class="song-position">${String(index + 1).padStart(2, '0')}</span>
              <img class="song-album-art" data-amplitude-song-info="cover_art_url" data-amplitude-song-index="${index}"/>
              <div class="song-meta-data-container">
                <span class="song-name" data-amplitude-song-info="name" data-amplitude-song-index="${index}"></span>
                <span class="song-artist" data-amplitude-song-info="artist" data-amplitude-song-index="${index}"></span>
              </div>
            `;
            
            songsContainer.appendChild(songDiv);
          });

          Amplitude.init({
            bindings: { 37: 'prev', 39: 'next', 32: 'play_pause' },
            debug: true,
            shuffle_on: true,
            visualization: 'michaelbromley_visualization',
            songs: songs,
            waveforms: { sample_rate: 50 },
            visualizations: [
              { object: MichaelBromleyVisualization, params: {} }
            ],
            callbacks: {
              loadeddata: function() {
                // Extract art once the audio file is fully loaded and ready
                const currentIndex = Amplitude.getActiveIndex();
                const currentSong = songs[currentIndex];
                
                if (currentSong.cover_art_url === coverArt) {
                  console.log('Extracting album art from loaded audio');
                  extractAlbumArtFromAudio().then(artworkUrl => {
                    // Update the song metadata
                    songs[currentIndex].cover_art_url = artworkUrl;
                    
                    // Update all image elements for this song
                    const largeArt = document.getElementById('large-now-playing-album-art');
                    if (largeArt) largeArt.src = artworkUrl;
                    
                    const smallArt = document.querySelector('.active-audio img.cover-art-small');
                    if (smallArt) smallArt.src = artworkUrl;
                    
                    const playlistArt = document.querySelector(`img.song-album-art[data-amplitude-song-index="${currentIndex}"]`);
                    if (playlistArt) playlistArt.src = artworkUrl;
                  });
                }
              }
            }
          });
        }).catch(err => {
          console.error("Error fetching track list:", err);
        });

        // Visualization toggle + playlist visibility controls
        document.addEventListener("DOMContentLoaded", () => {
          const visToggle = document.querySelector('.visualization-toggle');
          const albumArt = document.getElementById('large-now-playing-album-art');
          const vis = document.getElementById('large-visualization');
          const upArrow = document.querySelector('.arrow-up-icon');
          const downArrow = document.querySelector('.arrow-down-icon');
          const playlist = document.getElementById('visualizations-player-playlist');

          if (visToggle) {
            visToggle.addEventListener('click', function() {
              const on = this.classList.toggle('visualization-on');
              this.classList.toggle('visualization-off', !on);
              albumArt.style.display = on ? 'none' : 'block';
              vis.style.display = on ? 'block' : 'none';
            });
          }

          if (upArrow) upArrow.addEventListener('click', () => playlist.style.display = 'block');
          if (downArrow) downArrow.addEventListener('click', () => playlist.style.display = 'none');

          // Volume percentage display
          const volumeSlider = document.querySelector('.amplitude-volume-slider');
          const volumePercentage = document.querySelector('.volume-percentage');
          
          if (volumeSlider && volumePercentage) {
            // Wait for Amplitude to initialize, then set initial volume display
            setTimeout(() => {              
              const currentVolume = Amplitude.getVolume();
              volumePercentage.textContent = Math.round(currentVolume) + '%';
              volumeSlider.value = currentVolume;
            }, 100);
            
            // Update percentage when volume changes
            volumeSlider.addEventListener('input', function() {
              volumePercentage.textContent = this.value + '%';
            });
            
            // Also listen to Amplitude's volume change events
            document.addEventListener('volumechange', function() {
              const currentVolume = Amplitude.getVolume();
              volumePercentage.textContent = Math.round(currentVolume) + '%';
            });
          }
        });

        // Responsive scaling logic
        const player = document.getElementById('visualizations-player');
        
        function resizePlayer() {
          // Get available viewport space
          const vw = window.innerWidth;
          const vh = window.innerHeight;
          
          // Calculate player dimensions with proper constraints
          let playerWidth = Math.min(vw * 0.95, 500);
          
          // On very small screens, be more aggressive
          if (vw < 400) {
            playerWidth = vw * 0.98;
          }
          
          // Set the width
          player.style.width = playerWidth + "px";
          
          // Let content determine height naturally, but constrain to viewport
          player.style.height = 'auto';
          player.style.maxHeight = (vh * 0.95) + 'px';
          
          // Ensure minimum viable height based on width
          const minHeight = playerWidth * 1.3;
          player.style.minHeight = minHeight + 'px';
          
          // Enable scrolling if content overflows
          if (player.scrollHeight > vh * 0.95) {
            player.style.overflowY = 'auto';
            player.style.overflowX = 'hidden';
          } else {
            player.style.overflowY = 'hidden';
            player.style.overflowX = 'hidden';
          }
        }

        window.addEventListener('resize', resizePlayer);
        window.addEventListener('orientationchange', resizePlayer);
        document.addEventListener('DOMContentLoaded', resizePlayer);
      })();
    </script>
  </body>
</html>